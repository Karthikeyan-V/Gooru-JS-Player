var resourcePreview={init:function(A){EJS.ext=".template";var B=helper.getRequestParam();if(typeof (B.session_token)!="undefined"&&B.session_token!=""){USER.sessionToken=B.session_token}else{if(typeof (A)!="undefined"){USER.sessionToken=A.token}}$.ajaxSetup({data:{sessionToken:USER.sessionToken}});$("#gooru-resource-player-base-container").bind("activity.log",function(E,D,C){activityLog.init(C)});$(window).blur(function(){resourcePreview.resourcePlayerActivityStop()});resourcePreview.showResourcePreviewPopupBox(helper.getRequestParam())},showResourcePreview:function(previewValues){previewValues.useScribd=false;if(previewValues.documentId!=null&&previewValues.documentId!=""&&previewValues.documentKey!=null&&previewValues.documentKey!=""){previewValues.useScribd=true}previewValues.GOORU_REST_ENDPOINT=("https:"==document.location.protocol?"https://":"http://")+GOORU_REST_ENDPOINT;previewValues.DOC_HOME=DOC_HOME;previewValues.DOC_CACHE=DOC_CACHE;var resourcePreviewHeader=new EJS({url:STATIC_FILE_PATH+"/templates/resources/resourcePreviewHeader.template?buildId="+BUILD_TIME_STAMP}).render(previewValues);$("div#gooru-resource-player-base-container").css("height",($(window).height()-6));$("div#gooru-resource-player-base-container").html(resourcePreviewHeader);document.title=previewValues.title;var previewTemplate=new EJS({url:STATIC_FILE_PATH+"/templates/resources/resourcePreview.template"}).render(previewValues);var resourceMetaData=new EJS({url:STATIC_FILE_PATH+"/templates/resources/resourceMetaData.template"}).render(previewValues);$("#gooru-resource-player-meta-container").html(resourceMetaData);var previewHeight=$(window).height();with(previewValues){$("#meta-data-description").attr("content",publicMetaData);var signedBaseUrl=GOORU_REST_ENDPOINT+"/signed/resource/url/"+gooruOid;$("div#gooru-resource-player-container").html(previewTemplate);switch(type){case"video/youtube":var videoId=helper.getYoutubeVideoId(resourceUrl);resourcePlayers.youtubeVideo(videoId,startTime,"resourcePlayYoutubeplayer-"+gooruOid);break;case"animation/kmz":mtours.init((signedBaseUrl+"?file="+resourceUrl),"resourcePreviewGoogleEarthContainer");break;case"animation/swf":var fileExtension=resourceUrl.split(".").pop();if(fileExtension=="flv"){resourcePlayers.flvPlayer("../swf/flowplayer-3.2.11.swf","resourcePreviewFlashContainer")}else{resourcePlayers.animation((signedBaseUrl+"?file="+resourceUrl),"resourcePreviewFlashContainer")}break;case"textbook/scribd":if(useScribd){resourcePlayers.pdfReader(documentId,documentKey,startPPT,"resourcePreviewTextbookScribd")}break;case"assessment-question":resourcePlayers.questionResource(previewValues,"div.resourcePreviewBoxContentContainer");break}var activityLogId=generateGUID();$("div#gooru-resource-player-base-container").data("activity-log-id",activityLogId);$("div#gooru-resource-player-base-container").data("gooru-oid",gooruOid);activityLog.triggerActivityLog(activityLogId,"start",gooruOid,"resource-player",null,window.location,"resource-player-Start")}},showResourcePreviewPopupBox:function(D){var B=D.id;var C=D.resourceInstanceId;var A=GOORU_REST_ENDPOINT+"/resource/resourceSource/"+B+".json?";if(typeof (C)!="undefined"&&C!=null&&C!=""){A=GOORU_REST_ENDPOINT+"/collection/dummy/resourceInstance/"+C+".json"}$.ajax({type:"GET",url:A,dataType:"jsonp",success:function(E){resourcePreview.renderResourcePreview(E,D)},error:function(E){var F=new EJS({url:STATIC_FILE_PATH+"/templates/resources/resourcePlayerInfo.template"}).render({message:"Resource Not Found, Please check the resource Id - "+D.id,reduceSize:0});$("div#gooru-resource-player-base-container").html(F)}})},renderResourcePreview:function(B,D){var C=D.resourceInstanceId;if(B.length==0){return }var A={resourceUrl:null,type:null,startTime:null,startPPT:null,stopPPT:null,filePath:null,title:null,description:null,resourceSource:null,gooruOid:null,isWebResource:null,resourceExtenstion:null,stopTime:null,resourceUserRating:B.social.contentUserRating,resourceRating:B.social.contentRating,resourceViews:null,isResourceAlreadyAdded:B.social.isContentAlreadySubscribed,documentKey:null,documentId:null,resourcestatus:{},thumbnail:null,resourceInstanceId:C,narrative:null,category:null,tags:null,standards:[],standardDescriptions:[],resourceLicense:{},siteName:null,publicMetaData:B.publicMetaData,questionType:null,answers:null,questionExplanation:null,questionHints:null,questionImageURL:null,assetURI:null,resourceFormatType:B.resourceFormat.value};A.gooruOid=D.id;if(C!=null&&typeof (C)!="undefined"&&C!=""){A.gooruOid=B.resource.id;A.resourceUrl=B.resource.nativeurl;A.type=B.resource.type;if(A.type==="video/youtube"){A.startPPT=(B.resource.instructornotes.start==null)?"":B.resource.instructornotes.start;A.stopPPT=(B.resource.instructornotes.stop==null)?"":B.resource.instructornotes.stop}else{A.startPPT=(B.resource.instructornotes.start==null||B.resource.instructornotes.start=="")?1:B.resource.instructornotes.start;A.stopPPT=(B.resource.instructornotes.stop==null)?"":B.resource.instructornotes.stop}A.assetURI=B.resource.assetURI;A.filePath=B.resource.assetURI+B.resource.resourcefolder;A.title=(B.resource.label==null)?"":B.resource.label;A.description=(B.resource.description==null)?"":B.resource.description;A.resourceSource=B.source;A.category=(B.resource.category==null)?"":B.resource.category;A.tags=(B.resource.tags==null)?"":B.resource.tags;A.standards=(typeof (B.resourceTaxonomyData.curriculum)=="undefined"||B.resourceTaxonomyData.curriculum.curriculumCode==null)?"":B.resourceTaxonomyData.curriculum.curriculumCode;A.standardDescriptions=(typeof (B.resourceTaxonomyData.curriculum)=="undefined"||B.resourceTaxonomyData.curriculum.curriculumDesc==null)?"":B.resourceTaxonomyData.curriculum.curriculumDesc;A.documentId=(B.resource.documentid==null)?"":B.resource.documentid;A.documentKey=(B.resource.documentkey==null)?"":B.resource.documentkey;A.resourcestatus.statusIsBroken=B.resource.resourcestatus.statusIsBroken;A.resourcestatus.statusIsFrameBreaker=B.resource.resourcestatus.statusIsFrameBreaker;A.thumbnail=B.resource.thumbnail;if(typeof B.resource.instructornotes!="undefined"&&B.resource.instructornotes!=null){A.resourceNarrative=B.resource.instructornotes.instruction}if(typeof B.resourceSiteName!="undefined"&&B.resourceSiteName!=null){A.siteName=B.resourceSiteName}}else{A.resourceUrl=B.url;A.type=B.resourceType.name;A.startPPT=(B.start==null||B.start=="")?1:B.start;A.stopPPT=(B.stop==null)?"":B.stop;A.filePath=B.assetURI+B.folder;A.thumbnail=B.thumbnail;A.title=(B.title==null)?"":B.title;A.category=(B.category==null)?"":B.category;A.tags=(B.tags==null)?"":B.tags,A.standards=(typeof (B.resourceTaxonomyData.curriculum)=="undefined"||B.resourceTaxonomyData.curriculum.curriculumCode==null)?"":B.resourceTaxonomyData.curriculum.curriculumCode,A.standardDescriptions=(typeof (B.resourceTaxonomyData.curriculum)=="undefined"||B.resourceTaxonomyData.curriculum.curriculumDesc==null)?"":B.resourceTaxonomyData.curriculum.curriculumDesc,A.description=(B.description==null)?"":B.description;A.resourceSource=B.resourceSource;A.resourcestatus.statusIsBroken=B.brokenStatus;A.resourcestatus.statusIsFrameBreaker=B.hasFrameBreaker;A.siteName=B.siteName;A.assetURI=B.assetURI}A.resourceLicense=B.license;if(typeof (A.startPPT)==="string"){A.startTime=helper.calculateTime(startPPT)}else{if(typeof (A.startPPT)==="number"){A.startTime=A.startPPT}}if(typeof (A.stopPPT)==="string"){A.stopTime=helper.calculateTime(A.stopPPT)}else{if(typeof (A.stopPPT)==="number"){A.stopTime=A.stopPPT}}A.resourceViews=Number(B.resourceViews)+1;A.isWebResource=helper.isWebResource(A.resourceUrl,A.type);A.resourceExtenstion=helper.getResourceFileExtenstion(A.resourceUrl);if(A.type=="assessment-question"){A.questionType=B.typeName;A.answers=B.quizQuestion.answers;A.questionExplanation=B.explanation;A.questionHints=B.quizQuestion.hints;A.questionImageURL=resourcePreview.checkImageURLStatus(B.thumbnails.url)}resourcePreview.showResourcePreview(A);resourcePreview.showResourceCollections(A.gooruOid);helper.updateResourceViews(A.gooruOid,A.resourceViews);helper.previewToolTip(".resourceBottomPreviewTooltip","bottom");if(A.resourceLicense!=null&&typeof (A.resourceLicense.name)!="undefined"&&A.resourceLicense.name!="Other"&&A.resourceLicense.code!=""){helper.previewToolTip(".resourcePreviewTooltipLicense","bottom")}helper.previewToolTip(".resourceBottomPreviewTooltipOER","bottom");resourcePreview.handleResourcePreviewEvents()},showResourceCollections:function(A){$.ajax({type:"GET",url:GOORU_REST_ENDPOINT+"/search/scollection?&pageNum=1&pageSize=5&flt.resourceGooruOIds="+A+"&boostField.hasNoThumbnail=0",dataType:"jsonp",success:function(B){var C=new EJS({url:STATIC_FILE_PATH+"/templates/resources/resourceCollections.template"}).render({resourceCollection:B,HOME_URL:HOME_URL,TOKEN:USER.sessionToken});if(B.searchResults.length>0&&typeof (B.searchResults)!="undefined"){$("div#gooru-resource-player-learn-more-container").html(C);$("div#gooru-resource-player-learn-more-grey").hide();$("div#gooru-resource-player-learn-more").show();$("div.learn-more-image-container").mouseenter(function(){$(this).find("div.gooru-resource-player-learn-more-content").show()});$("div.learn-more-image-container").mouseleave(function(){$(this).find("div.gooru-resource-player-learn-more-content").hide()})}else{$("div#gooru-resource-player-learn-more-grey").show();$("div#gooru-resource-player-learn-more").hide()}},error:function(B,D,C){}})},handleResourcePreviewEvents:function(){$("div#gooru-resource-player-about").click(function(){$("span.resourcePreviewHeaderNavigationArrowLearnMore, span.resourcePreviewHeaderNavigationArrowShare, div#gooru-resource-player-share-container, div#gooru-resource-player-learn-more-container").hide();$("div#gooru-resource-player-header-container").find(".gooru-resource-player-menu-share-selected").removeClass("gooru-resource-player-menu-share-selected");$("div#gooru-resource-player-header-container").find(".gooru-resource-player-menu-learn-more-selected").removeClass("gooru-resource-player-menu-learn-more-selected");$("div#gooru-resource-player-about-header").toggleClass("gooru-resource-player-menu-about-selected");$("span.resourcePreviewHeaderNavigationArrowAbout, div#gooru-resource-player-about-container").slideToggle("slow",function(){A()})});$("div#gooru-resource-player-learn-more").click(function(){$("span.resourcePreviewHeaderNavigationArrowAbout, span.resourcePreviewHeaderNavigationArrowShare, div#gooru-resource-player-about-container ,div#gooru-resource-player-share-container").hide();$("div#gooru-resource-player-header-container").find(".gooru-resource-player-menu-share-selected").removeClass("gooru-resource-player-menu-share-selected");$("div#gooru-resource-player-header-container").find(".gooru-resource-player-menu-about-selected").removeClass("gooru-resource-player-menu-about-selected");$("div#gooru-resource-player-learn-more-header").toggleClass("gooru-resource-player-menu-learn-more-selected");$("div#gooru-resource-player-learn-more-container").slideToggle("slow",function(){A()});$("span.resourcePreviewHeaderNavigationArrowLearnMore").is(":visible")?$("span.resourcePreviewHeaderNavigationArrowLearnMore").hide():$("span.resourcePreviewHeaderNavigationArrowLearnMore").css("display","block")});function A(){var B=$(window).height();if($("div.gooru-resource-player-menu-container").is(":visible")){$(".gooru-resource-player-preview-container, div.resourcePreviewBoxContentContainer, div.gooru-question-play-container").css("height",(B-165))}else{$(".gooru-resource-player-preview-container, div.resourcePreviewBoxContentContainer, div.gooru-question-play-container").css("height",(B-47))}}},resourcePlayerActivityStop:function(){var A=$("div#gooru-resource-player-base-container").data("activity-log-id");var B=$("div#gooru-resource-player-base-container").data("gooru-oid");activityLog.triggerActivityLog(A,"stop",B,"resource-player",null,window.location,"resource-player-stop")},checkImageURLStatus:function(A){var B="";$.ajax({async:false,type:"GET",url:A,complete:function(C,D){B=(C.status==200)?A:null}});return B},questionResourcePlayEvents:function(){}};function onYouTubePlayerReady(A){var E=document.getElementById(A);var F=A.split("youtubeMovie-resourcePlayYoutubeplayer-")[1];var D=$("div#resourcePlayYoutubeplayer-"+F).data("videostop");var B=$("div#resourcePlayYoutubeplayer-"+F).data("fromprerender");if(E!=null){var C=E.getDuration();if(Number(D)>=Number(C)||Number(D)<=0){D=C-1}resourcePlayers.playVideo(E,D);E.addEventListener("onStateChange","onYouTubeStateChange")}}function onYouTubeStateChange(C){if(C===2||C===0){resourcePreview.resourcePlayerActivityStop()}if(C!=2){var A=$("div.currentlyPlayingYoutubeVideoResource").data("playerid");if(typeof (A)!="undefined"){var B=$("div.currentlyPlayingYoutubeVideoResource").data("videostop");var D=document.getElementById("youtubeMovie-resourcePlayYoutubeplayer-"+A);resourcePlayers.triggerStopVideo(D,B)}}}$(document).ready(function(){helper.userSignin({onComplete:resourcePreview.init});resourcePreview.init()});