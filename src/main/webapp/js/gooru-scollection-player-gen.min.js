var scollectionPlay={init:function(A){EJS.ext=".template";var B=helper.getRequestParam();if(typeof (B.session_token)!="undefined"&&B.session_token!=""){USER.sessionToken=B.session_token}else{if(typeof (A)!="undefined"){USER.sessionToken=A.token}}$.ajaxSetup({data:{sessionToken:USER.sessionToken}});$("#gooru-collection-player-base-container").bind("activity.log",function(E,D,C){activityLog.init(C)});scollectionPlay.showCollectionPlayCoverPage(helper.getRequestParam())},showCollectionPlayCoverPage:function(C){if(typeof (C.id)==="undefined"||C.id===""){var B=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerInfo.template"}).render({message:"Please provide collection Id",reduceSize:0});$("div#gooru-collection-player-base-container").html(B).css("height",$(window).height());return }var A=GOORU_REST_ENDPOINT+"/collection/"+C.id+"?includeCollectionItem=true&includeMetaInfo=true";$.ajax({type:"GET",url:A,dataType:"jsonp",success:function(D){scollectionPlay.renderCollectionPlayer(D,C)}})},renderCollectionPlayer:function(D,F){if(D.status==404){var E=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerInfo.template"}).render({message:"Collection Not Found, please check the collection Id - "+F.id,reduceSize:0});$("div#gooru-collection-player-base-container").html(E);return }else{if(D.status==403){var E=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerInfo.template"}).render({message:"You don't have permission to play this collection",reduceSize:0});$("div#gooru-collection-player-base-container").html(E);return }}document.title=D.title;$("div#gooru-collection-player-base-container").data("collectionId",D.gooruOid);$("div#gooru-collection-player-base-container").data("collectionOwnerId",D.user.gooruUId);$("div#gooru-collection-player-base-container").data("collectionOwnerName",D.user.usernameDisplay);var B=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerCoverPage.template"}).render({data:D});$("div#gooru-collection-player-base-container").html(B);var A=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerMeta.template"}).render({data:D});$("div#gooru-collection-player-cover-page-meta-container").html(A);helper.roundedCornerForIE();helper.previewToolTip(".collection-play-standards-preview","top");scollectionPlay.collectionPlayDialogBox("#collection-ack-dialog-container",696,true,$(window).height()-100);scollectionPlay.collectionPlayDialogBox("#collection-course-dialog-container",400,true,"auto");scollectionPlay.collectionPlayDialogBox("#collection-voc-dialog-container",400,true,"auto");scollectionPlay.collectionPlayDialogBox("#collection-standards-dialog-container",696,true,"auto");scollectionPlay.showCollectionPlayResourcePreview(D);var C=0;scollectionPlay.collectionSummaryPage(C);scollectionPlay.collectionPlayEventHandle(D)},collectionPlayEventHandle:function(A){$(".collection-ack-seemore").click(function(){$("#collection-ack-dialog-container").dialog("open");var B=$("div#gooru-collection-player-base-container").data("collectionId");scollectionPlay.collectionPlayResourceAcknowledgment(A)});$(".collection-course-seemore").click(function(){$("#collection-course-dialog-container").dialog("open");var B=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayercourse.template"}).render({course:A.metaInfo.course});$("div#collection-course-dialog-container").html(B);$("div.gooru-collection-player-course-button-okay").click(function(){$("#collection-course-dialog-container").dialog("close")})});$(".collection-voc-seemore").click(function(){$("#collection-voc-dialog-container").dialog("open");var B=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerVocabulary.template"}).render({vocabulary:A.vocabulary});$("div#collection-voc-dialog-container").html(B);$("div.gooru-collection-player-voc-button-okay").click(function(){$("#collection-voc-dialog-container").dialog("close")})});$(".collection-standards-seemore").click(function(){$("#collection-standards-dialog-container").dialog("open");var B=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerStandards.template"}).render({data:A.metaInfo.standards});$("div#collection-standards-dialog-container").html(B);$("div.gooru-collection-player-standards-button-okay").click(function(){$("#collection-standards-dialog-container").dialog("close")})});$("div#gooru-collection-player-cover-page-study-container").click(function(){$("div#gooru-collection-player-cover-page-container").hide();$("div#gooru-collection-player-resource-play-container").show();var B=$("div#collection-meta-analytic-view").data("views")+1;$("div#collection-meta-analytic-view").data("views",B);var E=(B>1)?"s":"";$("div#collection-meta-analytic-view").text(B+" view"+E);var D=$("div#gooru-collection-player-base-container").data("collectionId");helper.updateResourceViews(D,B);$("div#collection-segment-container").css("margin-left","0px");var C=Math.floor($("div#collection-segment-base-container").width()/$("div.collection-segment-content:eq(0)").width());$("span.gooru-collection-player-resource-prev-arrow").hide();if($("div.collection-segment-content").length>C){$("span.gooru-collection-player-resource-next-arrow").css("display","block")}$("div.collection-player-resource-content-val:eq(0)").trigger("click")});$("div#gooru-collection-player-nav-container").click(function(){$("div#gooru-collection-player-narrative-menu-arrow, div#gooru-collection-player-info-menu-arrow, div#gooru-collection-player-resource-play-menu-narrative-container ,div#gooru-collection-player-resource-play-menu-info-container").hide();$("div.gooru-collection-player-info-menu-icon").removeClass("gooru-collection-player-menu-info-selected");$("div.gooru-collection-player-narrative-menu-icon").removeClass("gooru-collection-player-narrative-menu-icon-selected");$("div.gooru-collection-player-nav-menu-icon").toggleClass("gooru-collection-player-nav-menu-icon-selected");$("div#gooru-collection-player-resource-play-menu-nav-container").slideToggle("slow",function(){resetResourcePreviewHeight()});if($("div#gooru-collection-player-nav-menu-arrow").is(":visible")){$("div#gooru-collection-player-nav-menu-arrow").hide();$("div#gooru-collection-player-base-container").data("selected-menu","none")}else{$("div#gooru-collection-player-nav-menu-arrow").css("display","block");$("div#gooru-collection-player-base-container").data("selected-menu","navigation")}});$("div#gooru-collection-player-info-container").click(function(){$("div#gooru-collection-player-narrative-menu-arrow, div#gooru-collection-player-nav-menu-arrow, div#gooru-collection-player-resource-play-menu-narrative-container ,div#gooru-collection-player-resource-play-menu-nav-container").hide();$("div.gooru-collection-player-nav-menu-icon").removeClass("gooru-collection-player-nav-menu-icon-selected");$("div.gooru-collection-player-narrative-menu-icon").removeClass("gooru-collection-player-narrative-menu-icon-selected");$("div.gooru-collection-player-info-menu-icon").toggleClass("gooru-collection-player-menu-info-selected");$("div#gooru-collection-player-resource-play-menu-info-container").slideToggle("slow",function(){resetResourcePreviewHeight()});if($("div#gooru-collection-player-info-menu-arrow").is(":visible")){$("div#gooru-collection-player-info-menu-arrow").hide();$("div#gooru-collection-player-base-container").data("selected-menu","info")}else{$("div#gooru-collection-player-info-menu-arrow").css("display","block");$("div#gooru-collection-player-base-container").data("selected-menu","info")}});$("div#gooru-collection-player-narrative-container").click(function(){$("div#gooru-collection-player-nav-menu-arrow, div#gooru-collection-player-info-menu-arrow, div#gooru-collection-player-resource-play-menu-nav-container ,div#gooru-collection-player-resource-play-menu-info-container").hide();$("div.gooru-collection-player-info-menu-icon").removeClass("gooru-collection-player-menu-info-selected");$("div.gooru-collection-player-nav-menu-icon").removeClass("gooru-collection-player-nav-menu-icon-selected");$("div.gooru-collection-player-narrative-menu-icon").toggleClass("gooru-collection-player-narrative-menu-icon-selected");$("div#gooru-collection-player-resource-play-menu-narrative-container").slideToggle("slow",function(){resetResourcePreviewHeight()});if($("div#gooru-collection-player-narrative-menu-arrow").is(":visible")){$("div#gooru-collection-player-narrative-menu-arrow").hide();$("div#gooru-collection-player-base-container").data("selected-menu","narrative")}else{$("div#gooru-collection-player-narrative-menu-arrow").css("display","block");$("div#gooru-collection-player-base-container").data("selected-menu","narrative")}});$("span.gooru-collection-resource-play-next-arrow-span").click(function(){var B=$("div.collection-player-resource-content-val-selected").index("div.collection-player-resource-content-val");if($("div.collection-player-resource-content-val:eq("+(B+1)+")").length>0){$("div.collection-player-resource-content-val:eq("+(B+1)+")").trigger("click");resetResourcePreviewHeight()}else{$("div.gooru-collection-player-resource-review-div").trigger("click")}});$("span.gooru-collection-resource-play-prev-arrow-span").click(function(){var B=$("div.collection-player-resource-content-val-selected").index("div.collection-player-resource-content-val");if($("div.collection-player-resource-content-val:eq("+(B-1)+")").length>0){$("div.collection-player-resource-content-val:eq("+(B-1)+")").trigger("click");resetResourcePreviewHeight()}else{$("div.gooru-collection-player-resource-home-div").trigger("click")}});$("div.gooru-collection-player-resource-home-div").click(function(){$("div#gooru-collection-player-cover-page-container").show();$("div#gooru-collection-resource-play-content").empty();$("div#gooru-collection-player-resource-play-container").hide()});$("div.gooru-collection-player-resource-review-div").click(function(){$("div#gooru-collection-resource-play-content").empty();$("div#gooru-collection-player-resource-play-container").hide();$("div#gooru-collection-player-resource-summary-container").show()})},collectionPlayDialogBox:function(B,C,D,A){$(B).dialog({autoOpen:false,width:C,resizable:false,modal:D,height:A});$(".ui-dialog-titlebar").remove()},collectionPlayResourceAcknowledgment:function(B){var A=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionPlayerAcknowledgement.template"}).render({data:scollectionPlay.groupResourceAcknowledgment(B)});$("div#collection-ack-dialog-container").html(A);helper.onErrorDefaultImage();$("div.gooru-collection-player-ack-button-okay").click(function(){$("#collection-ack-dialog-container").dialog("close")});$("div.gooru-collection-player-acknowledgement-list-content").each(function(){var D=$(this).find("div.collection-play-ack-resource").length;var C=(D*90);var E=$(this).data("sequence");$(this).find("div.collection-player-acknowledgement-list-inner-content").css("width",C);if(D>5){$("span.gooru-collection-player-next-arrow-"+E).css("display","block")}});$("span.gooru-collection-player-next-arrow").click(function(){var H=$(this).data("sequence");var D=Number($("div.collection-player-acknowledgement-list-inner-content-"+H).css("margin-left").replace("px",""));var G=$("div.gooru-collection-player-acknowledgement-list-content").width();var F=((G)+D);var C=$("div.collection-player-acknowledgement-list-inner-content-"+H).width();if(C>F){var E=F+G;if(E>=C){$("span.gooru-collection-player-next-arrow-"+H).hide()}$("div.collection-player-acknowledgement-list-inner-content-"+H).animate({marginLeft:"-"+F+"px"},800,function(){});$("span.gooru-collection-player-prev-arrow-"+H).css("display","block")}});$("span.gooru-collection-player-prev-arrow").click(function(F){var G=$(this).data("sequence");var C=Number($("div.collection-player-acknowledgement-list-inner-content-"+G).css("margin-left").replace("px",""));var E=$("div.gooru-collection-player-acknowledgement-list-content").width();var D=((E)+C);if(D==0){$("span.gooru-collection-player-prev-arrow-"+G).hide()}if(D>=0){$("div.collection-player-acknowledgement-list-inner-content-"+G).animate({marginLeft:"-"+D+"px"},800,function(){});$("span.gooru-collection-player-next-arrow-"+G).css("display","block")}})},groupResourceAcknowledgment:function(D){var A=[];var B=[];var E=D.collectionItems;for(var C=0;C<E.length;C++){if(E[C].resource.resourceSource!=null&&E[C].resource.resourceSource.attribution!=null&&E[C].resource.resourceSource.attribution!=""){if(typeof (A[E[C].resource.resourceSource.attribution])=="undefined"){if(E[C].resource.resourceSource.attribution!="Multiple Sources"){A[E[C].resource.resourceSource.attribution]=[]}}if(E[C].resource.resourceSource.attribution=="Multiple Sources"){B.push(E[C]);continue}A[E[C].resource.resourceSource.attribution].push(E[C])}}if(B.length>0){A["Multiple Sources"]=[];A["Multiple Sources"]=B}return A},showCollectionPlayResourcePreview:function(D){var C=new EJS({url:STATIC_FILE_PATH+"/templates/collection/resourcePlayHeader.template"}).render({data:D.collectionItems});$("div#gooru-collection-player-resource-play-container").html(C);helper.onErrorDefaultImage();var B=Math.floor($("div#collection-segment-base-container").width()/($("div.collection-segment-content:eq(0)").width()));var E=($("div#collection-segment-base-container").width()/B);$("div.collection-segment-content").css("width",E);var A=($("div.collection-segment-content").length*E)+2;$("div#collection-segment-container").css("width",A);if($("div.collection-segment-content").length>B){$("span.gooru-collection-player-resource-next-arrow").css("display","block")}$("span.gooru-collection-player-resource-next-arrow").click(function(){var G=Math.abs(Number($("div#collection-segment-container").css("margin-left").replace("px","")));var J=$("div#collection-segment-base-container").width();var I=((J)+G);var F=$("div#collection-segment-container").width();if(F>I){var H=I+J;if(H>=F){$("span.gooru-collection-player-resource-next-arrow").hide()}$("div#collection-segment-container").animate({marginLeft:"-"+I+"px"},800,function(){});$("span.gooru-collection-player-resource-prev-arrow").css("display","block")}});$("span.gooru-collection-player-resource-prev-arrow").click(function(I){var F=Number($("div#collection-segment-container").css("margin-left").replace("px",""));var H=$("div#collection-segment-base-container").width();var G=((H)+F);if(G==0){$("span.gooru-collection-player-resource-prev-arrow").hide()}if(G<=0){$("div#collection-segment-container").animate({marginLeft:G+"px"},800,function(){});$("span.gooru-collection-player-resource-next-arrow").css("display","block")}});$("div.collection-player-resource-content-val").click(function(){scollectionPlay.resourcePlayerActivityStop();$("div.collection-player-resource-content-val").removeClass("collection-player-resource-content-val-selected");$(this).addClass("collection-player-resource-content-val-selected");var F=JSON.parse(unescape($(this).data("resource-json")));var G=$(this).data("segment-index");scollectionPlay.resourcePreview(F);scollectionPlay.showResourceNarrative(F);scollectionPlay.showResourceInfo(F)})},resourcePlayerActivityStop:function(){var A=$("div#gooru-collection-player-base-container").data("activity-log-id");var B=$("div#gooru-collection-player-base-container").data("gooru-oid");activityLog.triggerActivityLog(A,"stop",B,"collection-resource-player",null,window.location,"collection-resource-player-stop")},resourceDataFormatter:function(T){var M="0";var A="";var D="";var G="0";var J=typeof (T.resource.url)!="undefined"?T.resource.url:"";var E=T.resource.resourceType.name;var B=(T.start!=null&&T.start!="")?T.start:1;var P=(T.stop!=null&&T.stop!="")?T.stop:"";var L=T.resource.assetURI+T.resource.folder;var V=(T.title==null)?T.resource.title:T.title;var Q=(T.description==null)?T.resource.description:T.description;var R=typeof (T.resource.resourceSource)!="undefined"?T.resource.resourceSource:null;var C=(T.documentid==null)?"":T.documentid;var O=(T.documentkey==null)?"":T.documentkey;var F=(typeof (T.narration)!="undefined"&&T.narration!=null)?T.narration:"";var K=T.resource.hasFrameBreaker!=null&&T.resource.hasFrameBreaker?1:0;var I={statusIsFrameBreaker:K};var U=T.resource.gooruOid;var H=typeof (T.standards)!="undefined"?T.standards:[];if(typeof (B)==="string"){M=helper.calculateTime(B)}else{if(typeof (B)==="number"){M=(T.start!=null&&T.start!="")?T.start:0}}if(typeof (P)==="string"){G=helper.calculateTime(P)}else{if(typeof (P)==="number"){G=P}}var N=$("div#gooru-collection-player-base-container").data("collectionOwnerId");var S={resourceUrl:J,type:E,startTime:M,startPPT:B,stopPPT:P,filePath:L,title:V,description:Q,resourceSource:R,standards:H,options:D,isWebResource:helper.isWebResource(J,E),resourceExtenstion:helper.getResourceFileExtenstion(J),stopTime:G,documentId:C,documentKey:O,narrative:F,resourceUserId:N,resourcestatus:I,thumbnail:T.resource.thumbnail,category:T.resource.category,gooruOid:U,resourceInstanceId:T.resourceInstanceId,resource:T.resource,collectionOwnerName:$("div#gooru-collection-player-base-container").data("collectionOwnerName")};return S},resourcePreview:function(previewValues){var useScribd=false;if(previewValues.documentId!=""&&previewValues.documentKey!=""){useScribd=true}previewValues.useScribd=useScribd;var resourcePreviewHtml=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionResourcePreview.template"}).render(previewValues);with(previewValues){$("div#gooru-collection-player-header-resource-title").html(title);$("div#gooru-collection-player-overlay-icon-header").removeClass();$("div#gooru-collection-player-overlay-icon-header").addClass("gooru-collection-player-overlay-icon");$("div#gooru-collection-player-overlay-icon-header").addClass("gooru-collection-player-overlay-icon-"+category.toLowerCase());var signedBaseUrl=GOORU_REST_ENDPOINT+"/signed/resource/url/"+gooruOid;$("div#gooru-collection-resource-play-content").html(resourcePreviewHtml);switch(type){case"video/youtube":var videoId=helper.getYoutubeVideoId(resourceUrl);resourcePlayers.youtubeVideo(videoId,startTime,"resourcePlayYoutubeplayer-"+gooruOid);break;case"animation/kmz":mtours.init((signedBaseUrl+"?file="+resourceUrl),"collectionResourcePreviewGoogleEarthContainer");break;case"animation/swf":var fileExtension=resourceUrl.split(".").pop();if(fileExtension=="flv"){resourcePlayers.flvPlayer("../swf/flowplayer-3.2.11.swf","collectionResourcePreviewFlashContainer")}else{resourcePlayers.animation((signedBaseUrl+"?file="+resourceUrl),"collectionResourcePreviewFlashContainer")}break;case"textbook/scribd":if(useScribd){resourcePlayers.pdfReader(documentId,documentKey,startPPT,"collectionResourcePreviewTextbookScribd")}break;case"assessment-question":previewValues.questionType=resource.type!=null?resource.type:resource.typeName;previewValues.answers=resource.answers;previewValues.questionExplanation=resource.explanation;previewValues.questionHints=resource.hints;previewValues.questionImageURL=resource.thumbnails.url;resourcePlayers.questionResource(previewValues,"div.collectionResourcePreviewBoxContentContainer");break}var activityLogId=generateGUID();$("div#gooru-collection-player-base-container").data("activity-log-id",activityLogId);$("div#gooru-collection-player-base-container").data("gooru-oid",gooruOid);activityLog.triggerActivityLog(activityLogId,"start",gooruOid,"collection-resource-play",null,window.location,"collection-resource-play-Start")}},showResourceNarrative:function(A){if(typeof (A.narrative)!="undefined"&&A.narrative!=null&&A.narrative.length>0){var C=new EJS({url:STATIC_FILE_PATH+"/templates/collection/resourceNarrative.template"}).render(A);$("div#gooru-collection-player-resource-play-menu-narrative-container").html(C);var B=$("div#gooru-collection-player-base-container").data("selected-menu");$("div#gooru-collection-player-narrative-container-disabled").hide();$("div#gooru-collection-player-narrative-container").show();if(B==="narrative"&&!$("div#gooru-collection-player-narrative-container").is(":visible")){$("div#gooru-collection-player-narrative-container").trigger("click")}}else{$("div#gooru-collection-player-narrative-container, div#gooru-collection-player-narrative-menu-arrow").hide();$("div#gooru-collection-player-narrative-container-disabled").show();$("div#gooru-collection-player-resource-play-menu-narrative-container").empty().hide();$("div.gooru-collection-player-narrative-menu-icon").removeClass("gooru-collection-player-narrative-menu-icon-selected");resetResourcePreviewHeight()}},showResourceInfo:function(B){var F=new EJS({url:STATIC_FILE_PATH+"/templates/collection/resourceAbout.template"}).render(B);$("div#gooru-collection-player-resource-play-menu-info-container").html(F);helper.roundedCornerForIE();helper.previewToolTip(".resourceBottomPreviewTooltip","bottom");helper.previewToolTip(".resourcePreviewTooltipLicense","bottom");helper.previewToolTip(".resourceBottomPreviewTooltipOER","bottom");var A=$("div#gooru-collection-resource-player-social-views").data("views")+1;var D=$("div#gooru-collection-resource-player-social-views").data("gooruoid");$("div#gooru-collection-resource-player-social-views").data("views",A);var E=(A>1)?"s":"";$("div#gooru-collection-resource-player-social-views").text(A+" view"+E);helper.updateResourceViews(D,A);var C=$("div#gooru-collection-player-base-container").data("selected-menu");$("div#gooru-collection-player-info-container").show();if(C==="info"&&!$("div#gooru-collection-player-info-container").is(":visible")){$("div#gooru-collection-player-info-container").trigger("click")}},collectionSummaryPage:function(B){var A=GOORU_REST_ENDPOINT+"/search/scollection";$.ajax({type:"GET",url:A,cache:false,data:{sessionToken:USER.sessionToken,pageSize:5,pageNum:B},dataType:"jsonp",success:function(D){EJS.ext=".template";var C=new EJS({url:STATIC_FILE_PATH+"/templates/collection/collectionSummaryPage.template"}).render({data:D,HOME_URL:HOME_URL,TOKEN:USER.sessionToken});$("#gooru-collection-player-base-container").html(C);$(".searchCollectionBox").mouseover(function(){$(this).find(".collectionImageOverlay, .playIconSmall").stop(true,true).fadeIn(300);$(this).find(".collectionImageOverlay").css("display","block");$(this).find(".playIconSmall").css("display","block")});$(".searchCollectionBox").mouseout(function(){$(this).find(".collectionImageOverlay, .playIconSmall").stop(true,true).fadeOut(300);-$(this).find(".collectionImageOverlay").css("display","none");$(this).find(".playIconSmall").css("display","none")});$("#scrollContentLoader").removeClass("loading")},error:function(C){}})}};function resetResourcePreviewHeight(){var A=$(window).height();if($("div.collection-resource-play-menu-container").is(":visible")){$(".gooru-collection-player-preview-container").css("height",(A-155))}else{$(".gooru-collection-player-preview-container").css("height",(A-62))}}function onYouTubePlayerReady(A){var E=document.getElementById(A);var F=A.split("youtubeMovie-resourcePlayYoutubeplayer-")[1];var D=$("div#resourcePlayYoutubeplayer-"+F).data("videostop");var B=$("div#resourcePlayYoutubeplayer-"+F).data("fromprerender");if(E!=null){var C=E.getDuration();if(Number(D)>=Number(C)||Number(D)<=0){D=C-1}resourcePlayers.playVideo(E,D);E.addEventListener("onStateChange","onYouTubeStateChange")}}function onYouTubeStateChange(C){if(C===2||C===0){scollectionPlay.resourcePlayerActivityStop()}if(C!=2){var A=$("div.currentlyPlayingYoutubeVideoResource").data("playerid");if(typeof (A)!="undefined"){var B=$("div.currentlyPlayingYoutubeVideoResource").data("videostop");var D=document.getElementById("youtubeMovie-resourcePlayYoutubeplayer-"+A);resourcePlayers.triggerStopVideo(D,B)}}}$(document).ready(function(){scollectionPlay.collectionSummaryPage(1)});